# detection-engineering-microsoft

Detection engineering using **Microsoft Sentinel** and **Microsoft Defender** telemetry,
with a clear separation between **testing**, **detection logic**, and **SOC operations**.

---

## Detection → Alert → SOC Investigation Flow

This repository is responsible for **testing attacker behaviour and engineering detections**.
Once detections generate alerts, **SOC investigation takes place in a separate SOC repository**.

The flow is:

1. Attack simulations generate telemetry  
2. Detections are written and validated against that telemetry  
3. Alerts are investigated by SOC operations  

The same telemetry is reused across stages, with **no duplication of logic or documentation**.

---

## 1. Attack Simulation & Telemetry Generation

**Purpose**  
Generate realistic attacker telemetry in a controlled environment to support
detection engineering.

This stage answers:

- What attacker behaviour looks like in Microsoft telemetry
- Which data sources are produced
- What fields and patterns are available for detection logic

All attack execution lives under `testing/`.

### Structure

```text
testing/
└── attack-simulations/
    ├── atomic-red-team-setup.md        # installation only
    ├── running-atomic-tests.md         # execution only
    ├── _template/
    │   ├── attack.md                   # what was executed
    │   ├── telemetry.md                # what telemetry appeared
    │   └── kql.md                      # exploratory queries
    ├── T1059_Command_and_Scripting/
    ├── T1110_Brute_Force/
    └── T1078_Valid_Accounts/
````

This layer **does not contain detections**.
It exists solely to produce and understand telemetry.

---

## 2. Detection Engineering (This Repository’s Core Responsibility)

**Purpose**
Engineer, test, and refine detections using telemetry generated from attack simulations.

This stage answers:

* What detection logic reliably identifies the behaviour
* How the logic performs against known-good telemetry
* How false positives are reduced

Detections live under `detections/` and **consume telemetry from testing**.

### Structure

```text
detections/
├── _template/
│   └── detection.md                   # canonical detection format
│
├── identity/
│   └── DE-IDENT-001-example-detection/
│       ├── rule.kql
│       └── detection.md
│
├── endpoint/
│   └── DE-ENDP-001-example-detection/
│       ├── rule.kql
│       └── detection.md
│
├── email/
├── cloud/
└── network/
```

Each detection references:

* Relevant attack simulations
* Relevant telemetry observations
* The KQL logic used to generate alerts

This repository is the **source of truth for detection logic**.

---

## 3. Alert Generation (Boundary Point)

When a detection is enabled in Microsoft Sentinel:

* Telemetry generated from testing triggers the rule
* An alert is created exactly as it would be in production

At this point:

* Detection engineering stops
* SOC operations begin

---

## 4. SOC Operations (Separate Repository)

**Purpose**
Investigate alerts generated by detections engineered here.

SOC investigation artifacts are intentionally stored in a **separate SOC repository**
to reflect operational ownership.

Each SOC incident references the originating detection, but **never reimplements it**.

Example reference:

```text
Detection source:
https://github.com/yourname/detection-engineering-microsoft/detections/identity/DE-IDENT-001-example-detection
```

---

## Design Principles

* Attack simulations generate telemetry
* Detection engineering consumes telemetry
* SOC operations consume alerts
* Logic is written once and reused
* Engineering and operations remain cleanly separated

---

## Summary Rule

> **Testing creates telemetry**
> **Detections create alerts**
> **SOC investigates outcomes**

---

## Repository Structure

```text
detection-engineering-microsoft/
├── README.md
│
├── meta/
│   ├── data-sources.md
│   ├── naming-conventions.md
│   └── maturity-model.md
│
├── testing/
│   └── attack-simulations/
│       ├── atomic-red-team-setup.md
│       ├── running-atomic-tests.md
│       ├── _template/
│       │   ├── attack.md
│       │   ├── telemetry.md
│       │   └── kql.md
│       ├── T1059_Command_and_Scripting/
│       ├── T1110_Brute_Force/
│       └── T1078_Valid_Accounts/
│
├── detections/
│   ├── _template/
│   │   └── detection.md
│   ├── identity/
│   ├── endpoint/
│   ├── email/
│   ├── cloud/
│   └── network/
```

---
